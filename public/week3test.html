<!DOCTYPE html>

<!--

Antonina (Toni) York
OSU CS 467 Spring 2017
Team Aries: Infinite Blank
Week 3 SVG Testing
week3test.html

This draws heavily from the examples found at:
https://github.com/oreillymedia/svg-essentials-examples

-->

<html xmlns="http://www.w3.org/1999/xhtml">

	<head>

		<meta http-equiv="content-type" content="text/html; charset=utf-8">

		<title>Team Aries: Week 3 SVG and JavaScript Testing</title>

		<style type="text/css">
			/* make form entries begin on a new line */
			label {display: block;}
			h1 {font-size: 125%;}
			input[type=number] {width: 35px;}
		</style>
		<script src="js/svg.js/dist/svg.min.js"></script>
		<script src="js/jquery-3.2.1.js"></script>

	</head>

	<body onload="init()">

		<h1>Team Aries: Week 3 SVG and JavaScript Testing</h1>

		<div>

			<form id="controls">
				
				<label>
					SEE DEBUG MESSAGES: 
					<input type="checkbox" name="debugging" value="debugging"
						onchange="changeDebugging(this.checked)"> </input>
				</label>
				
				<label>
					SELECT COLOR: 
					<input type="color" name="color" value="#000000"
						onchange="changeColor(this.value)">
				</label>
				
				<label>
					TOGGLE SHAPE FILL: 
					<input type="checkbox" name="shapefill" value="shapefill"
						onchange="changeShapeFill(this.checked)"> </input>
				</label>
				
				<label>
					SELECT STROKE WIDTH: 
					<input type="number" name="strokewidth"
						value="1" min="1" max="50"
						onchange="changeStrokeWidth(this.value)"> </input>
				</label>
				
				<label>
					SELECT TOOL: 
					<input type="radio" name="tool" value="0" checked
						onclick="changeTool(this.value)"> Rectangle</input>
					<input type="radio" name="tool" value="1"
						onclick="changeTool(this.value)"> Ellipse</input>
				</label>
				<label>
					SUBMIT EDITS:
					<input type="button" name="submit_button" onclick="onFormSubmit()"/>

			</form>
			
			<br>
			<div class="canvas" id="fakecanvas">
			<!--<object id="canvasObject" data="canvas.svg" type="image/svg+xml" border="3">-->
				<!--<p>Whoops, your browser does not seem to support SVG. :(</p>-->
			</object>
			</div>
		</div>
		<script type="text/javascript">

		function init() {
			var draw = SVG('fakecanvas');
			draw.svg(<svg id="svgCanvas" width="600" height="350" viewBox="0 0 600 350"
	onload="init(evt)"
	xmlns="http://www.w3.org/2000/svg"
	xmlns:xlink="http://www.w3.org/1999/xlink"
	version="1.1">
	<script type="text/javascript" xlink:href="js/svg.js/dist/svg.min.js"></script>>
	<script type="text/ecmascript"> <![CDATA[
		var debugging = false;
		var canvas;
		var canvasWidth = 600;
		var canvasHeight = 350;
		var svgns;
		var xOffset = 0;
		var yOffset = 0;
		var xStart = 0;
		var yStart = 0;
		var colorChoice = "#000000";
		var toolList = ["Rectangle", "Ellipse"];
		var toolChoice = 0;
		var strokeWidthChoice = 1;
		var shapeFillChoice = false;
		var shapeFillNone = "none";
		var shapeFillChoiceString = shapeFillNone;
		var currentObject = 0;
	
		function init(evt) {
			// select the empty svg object, get its namespace and offsets
			canvas = document.getElementById("svgCanvas");
			svgns = canvas.namespaceURI;
			var coords = canvas.getBoundingClientRect();
			xOffset = coords.left;
			yOffset = coords.top;
		
			// set up event listeners for the canvas
			canvas.addEventListener("mousedown", mouseDown);
			canvas.addEventListener("mousemove", mouseMove);
			canvas.addEventListener("mouseup", mouseUp);
			canvas.addEventListener("click", mouseClick);
			
			// link HTML functions to SVG functions
			top.setDebugging = svgSetDebugging;
			top.setColor = svgSetColor;
			top.setShapeFill = svgSetShapeFill;
			top.setStrokeWidth = svgSetStrokeWidth;
			top.setTool = svgSetTool;
		}
		
		function svgSetDebugging(newState) {
			debugging = newState;
		}
		
		function svgSetColor(newColor) {
			colorChoice = newColor;
			if (debugging) {alert("Color changed to " + colorChoice + ".");}
		}
		
		function svgSetShapeFill(newState) {
			shapeFillChoice = newState;
			if (debugging) {alert("Shape fill set to " + shapeFillChoice + ".");}
		}
		
		function svgSetStrokeWidth(newWidth) {
			if (newWidth < 1) {
				newWidth = 1;
			}
			else if (newWidth > 50) {
				newWidth = 50;
			}
			strokeWidthChoice = newWidth;
			if (debugging) {alert("Stroke width set to " + strokeWidthChoice.toString() + ".");}
		}
		
		function svgSetTool(newTool) {
			toolChoice = newTool;
			if (debugging) {alert("Tool changed to " + toolList[toolChoice] + ".");}
		}
		
		function mouseDown(evt) {
			switch(toolChoice) {
				case 0: // rectangle
					xStart = evt.clientX - xOffset;
					yStart = evt.clientY - yOffset;
					var newRect;
					newRect = document.createElementNS(svgns, "rect");
					newRect.setAttribute("id", currentObject.toString());
					newRect.setAttribute("x", xStart.toString());
					newRect.setAttribute("y", yStart.toString());
					newRect.setAttribute("width", "0");
					newRect.setAttribute("height", "0");
					if (shapeFillChoice) {
						shapeFillChoiceString = colorChoice;
					} else {
						shapeFillChoiceString = shapeFillNone;
					}
					newRect.setAttribute("style", "fill: " +
						shapeFillChoiceString + "; stroke: " + 
						colorChoice + "; stroke-width: " +
						strokeWidthChoice.toString());
					canvas.appendChild(newRect);
					break;
					
				case 1: // ellipse
					xStart = evt.clientX - xOffset;
					yStart = evt.clientY - yOffset;
					var newEllipse;
					newEllipse = document.createElementNS(svgns, "ellipse");
					newEllipse.setAttribute("id", currentObject.toString());
					newEllipse.setAttribute("cx", xStart.toString());
					newEllipse.setAttribute("cy", yStart.toString());
					newEllipse.setAttribute("rx", "0");
					newEllipse.setAttribute("ry", "0");
					if (shapeFillChoice) {
						shapeFillChoiceString = colorChoice;
					} else {
						shapeFillChoiceString = shapeFillNone;
					}
					newEllipse.setAttribute("style", "fill: " +
						shapeFillChoiceString + "; stroke: " + 
						colorChoice + "; stroke-width: " +
						strokeWidthChoice.toString());
					canvas.appendChild(newEllipse);
					break;
					
				default: // should never get here
					alert("Something went horribly awry with the tool picker.");
			}
		}
		
		function mouseMove(evt) {
			switch(toolChoice) {
				case 0: // rectangle
					
					// get mouse coordinates in the canvas
					var xMouse = evt.clientX - xOffset;
					var yMouse = evt.clientY - yOffset;
					
					// get the current rectangle
					var newRect;
					newRect = document.getElementById(currentObject.toString());
					
					// calculate new rectangle info
					var xNew = Math.min(xMouse, xStart);
					var yNew = Math.min(yMouse, yStart);
					var wNew =  Math.abs(xMouse - xStart);
					var hNew =  Math.abs(yMouse - yStart);
					
					// set new rectangle info
					newRect.setAttribute("x", xNew.toString());
					newRect.setAttribute("y", yNew.toString());
					newRect.setAttribute("width", wNew.toString());
					newRect.setAttribute("height", hNew.toString());
					break;
					
				case 1: // circle
					
					// get mouse coordinates in the canvas
					var xMouse = evt.clientX - xOffset;
					var yMouse = evt.clientY - yOffset;
					
					// get the current circle
					var newEllipse;
					newEllipse = document.getElementById(currentObject.toString());
					
					// calculate new rectangle info
					var xNew = Math.min(xMouse, xStart);
					var yNew = Math.min(yMouse, yStart);
					var wNew =  Math.abs(xMouse - xStart);
					var hNew =  Math.abs(yMouse - yStart);
					
					// calculate new circle info
					var rxNew = wNew/2;
					var ryNew = hNew/2;
					var cxNew = xNew + rxNew;
					var cyNew = yNew + ryNew;
					
					// set new circle info
					newEllipse.setAttribute("cx", cxNew.toString());
					newEllipse.setAttribute("cy", cyNew.toString());
					newEllipse.setAttribute("rx", rxNew.toString());
					newEllipse.setAttribute("ry", ryNew.toString());
					break;
					
				default: // should never get here
					alert("Something went horribly awry with the tool picker.");
			}
		}
		
		function mouseUp(evt) {
			switch(toolChoice) {
				case 0: // rectangle
					if (debugging) {
						var newRect = document.getElementById(currentObject.toString());
						alert(currentObject.toString() + ": Made a rectangle at (" +
								newRect.getAttribute("x") +	", " +
								newRect.getAttribute("y") + ") with width: " +
								newRect.getAttribute("width") + " and height: " +
								newRect.getAttribute("height") + ".");
					}
					currentObject += 1;
					break;
				
				case 1: // circle
					if (debugging) {
						var newCircle = document.getElementById(currentObject.toString());
						alert(currentObject.toString() + ": Made an ellipse at (" +
								newCircle.getAttribute("cx") +	", " +
								newCircle.getAttribute("cy") + ") with x-radius: " +
								newCircle.getAttribute("rx") + " and y-radius: " +
								newCircle.getAttribute("ry") + ".");
					}
					currentObject += 1;
					break;
					
				default: // should never get here
					alert("Something went horribly awry with the tool picker.");
			}
		}
		
		function mouseClick(evt) {
			switch(toolChoice) {
				case 0: // rectangle
					
					break;
				
				case 1: // circle
					
					break;
				default: // should never get here
					alert("Something went horribly awry with the tool picker.");
			}
		}
	]]> </script>
</svg>)
			return true;
		}

		SVG.wrap = function(node) {
    /* Wrap an existing node in an SVG.js element. This is a slight hack
     * because svg.js does not (in general) provide a way to create an
     * Element of a specific type (eg SVG.Ellipse, SVG.G, ...) from an
     * existing node and still call the Element's constructor.
     *
     * So instead, we call the Element's constructor and delete the node
     * it created (actually, just leaving it to garbage collection, since it
     * hasn't been inserted into the doc yet), replacing it with the given node.
     *
     * Returns the newly created SVG.Element instance.
     */
    	if (node.length) node = node[0];    // Allow using with or without jQuery selections
    	var element_class = capitalize(node.nodeName);
    		try {
        		var element = new SVG[element_class];
    		} catch(e) {
        		throw("No such SVG type '"+element_class+"'");
    		}
    		element.node = node;
    		return element;
			};

			function capitalize(string) {
    			if (!string) return string;
    			return string[0].toUpperCase() + string.slice(1);
			}
		
			function changeDebugging(newState) {
				window.setDebugging(newState);
			}
			
			function changeColor(newColor) {
				window.setColor(newColor);
			}
			
			function changeShapeFill(newState) {
				window.setShapeFill(newState);
			}
			
			function changeStrokeWidth(newWidth) {
				newWidth = parseInt(newWidth);
				if (!isNaN(newWidth)) {
					window.setStrokeWidth(newWidth);
				}
			}
			
			function changeTool(newTool) {
				newTool = parseInt(newTool);
				if (!isNaN(newTool)) {
					window.setTool(newTool);
				}
			}
			
			function onFormSubmit() {
				var draw = SVG.wrap($('#my-path'));
				draw.each(function(i,children){
					console.log(i);
				})
				//package them as strings and send to resource on app server
				return false;
			}
			
		</script>

	</body>

</html>
